<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Quest√µes ENEM ‚Äì M√∫sica</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  
  <script src="/static/js/medalhas_enem.js"></script>
  <style>
    .enem-music-ex-container { background: #fff; border-radius: 18px; max-width: 940px; margin: 26px auto 30px auto; box-shadow: 0 4px 32px #1976d215; padding: 32px 34px 25px 34px; display: flex; flex-direction: column; align-items: stretch; }
    .enem-music-title { font-size: 1.4em; color: #ab47bc; font-weight: bold; display: flex; align-items: center; gap: 12px; margin-bottom: 18px; margin-top: 0; justify-content: flex-start; }
    .enem-music-medals-row { display: flex; flex-wrap: wrap; gap: 13px 18px; margin-bottom: 20px; align-items: center; }
    .enem-music-medal-item { display: flex; align-items: center; gap: 7px; font-size: 1em; background: #f5f5f5; border-radius: 7px; padding: 5px 13px; min-width: 90px; border: 1px solid #e3e3e3; justify-content: center; }
    .enem-music-medal { font-size: 1.3em; padding-right: 2px; vertical-align: middle; }
    .enem-music-medal-gold { color: #ffb300; }
    .enem-music-medal-silver { color: #90caf9; }
    .enem-music-medal-bronze { color: #bcaaa4; }
    .enem-music-topic-title { font-size: 1.13em; color: #ab47bc; font-weight: bold; margin-bottom: 7px; display: flex; align-items: center; gap: 6px; }
    .enem-music-question { font-size: 1.09em; margin-bottom: 13px; color: #1a237e; }
    .enem-music-options label { display: block; margin-bottom: 9px; background: #f3e5f5; border-radius: 6px; padding: 9px 13px; cursor: pointer; transition: background 0.18s; font-size: 1.09em; border: 1px solid #e1bee7; }
    .enem-music-options input[type="radio"] { margin-right: 8px; }
    .enem-music-options label.correct { background: #dcedc8; font-weight: 600; }
    .enem-music-options label.incorrect { background: #ffcdd2; font-weight: 600; }
    .enem-music-options input[disabled] + span, .enem-music-options input[disabled] { cursor: not-allowed; }
    .enem-music-feedback { margin-top: 7px; font-weight: bold; min-height: 18px; }
    .enem-music-explanation { margin-top: 5px; font-size: 0.98em; color: #1a237e; background: #e7f7e7; border-radius: 5px; padding: 6px 12px; margin-bottom: 5px; display: inline-block; }
    .enem-music-next-btn { background: #ab47bc; color: #fff; border: none; border-radius: 4px; padding: 8px 22px; font-size: 1.06em; cursor: pointer; margin-top: 16px; transition: background 0.18s; display: none; }
    .enem-music-next-btn.active { display: inline-block; }
    .enem-music-progress { margin-top: 15px; color: #888; font-size: 0.98em; }
    @media (max-width: 1100px) { .enem-music-ex-container { max-width: 99vw; padding: 3vw 1vw; } }
    @media (max-width: 700px) { .enem-music-title { font-size: 1.1em; margin-top: 8px; } .enem-music-medals-row { flex-direction: column; gap: 7px; } .enem-music-medal-item { min-width: 0; width: 100%; } .enem-music-ex-container { padding: 2vw 2vw; } }
    .enem-music-end-message { text-align: center; padding: 25px 0; max-width: 540px; margin: 0 auto; background: #f8f5fa; border-radius: 10px; box-shadow: 0 3px 12px #ab47bc30; margin-top: 24px; }
  </style>
</head>
<body>
<div class="enem-music-ex-container">
  <div class="enem-music-title">
    <i class="fa-solid fa-music"></i>
    Quest√µes ENEM ‚Äì M√∫sica
  </div>
  <div id="enem-music-medals"></div>
  <div id="enem-music-root"></div>
</div>

<script src="/static/js/medalhas_enem.js"></script>
<script>
// ====== QUEST√ïES REAIS DE M√öSICA DO ENEM ======
const enemMusicTopics = [
  {
    icon: "fa-music",
    color: "#ab47bc",
    title: "Leitura e Interpreta√ß√£o de Can√ß√µes em L√≠ngua Inglesa",
    questions: [
      {
        q: `<b>Leia os versos da can√ß√£o "Fall on Me" (R.E.M., 1986):</b><br>
        <i>
        "There's a problem, feathers, iron<br>
        Bargain buildings, weights and pulleys<br>
        Feathers hit the ground before the weight can leave the air"
        </i>
        <br><span style="font-size:0.97em;color:#888;">Fonte: <a href="https://www.azlyrics.com/lyrics/rem/fallonme.html" target="_blank">azlyrics.com</a></span>
        <br><br>
        A qual epis√≥dio (real ou hipot√©tico) da hist√≥ria da f√≠sica o trecho da m√∫sica faz alus√£o?`,
        a: [
          { text: "√Ä queda de uma ma√ß√£, que teria inspirado Newton √† descoberta da gravita√ß√£o universal.", isCorrect: false },
          { text: "√Ä observa√ß√£o de um p√°ssaro em voo, que teria levado Einstein a formular a teoria da relatividade.", isCorrect: false },
          { text: "Aos experimentos com objetos de massas diferentes, que teriam indicado a Galileu os princ√≠pios da queda livre.", isCorrect: true },
          { text: "Ao transbordamento da √°gua em uma banheira, que teria sugerido a Arquimedes o conceito de empuxo.", isCorrect: false },
          { text: "√Ä queda de um bloco de ferro ligado a uma h√©lice, que teria levado Joule √† equival√™ncia entre calor e energia.", isCorrect: false }
        ],
        explicacao: "O trecho faz alus√£o ao princ√≠pio da queda livre e aos experimentos de Galileu Galilei, demonstrando que objetos de diferentes massas caem com a mesma acelera√ß√£o na aus√™ncia de resist√™ncia do ar."
      },
        {
    q: `<b>Leia o trecho da can√ß√£o "When Johnny comes marching home" (Patrick Sarsfield Gilmore):</b><br>
    <i>
    When Johnny comes marching home again<br>
    Hurrah! Hurrah!<br>
    We'll give him a hearty welcome then<br>
    Hurrah! Hurrah!<br>
    The men will cheer and the boys will shout<br>
    The ladies they will all turn out<br>
    </i>
    <br>
    <span style="font-size:0.97em;color:#888;">
      Fonte: <a href="https://www.battlefields.org/learn/primary-sources/civil-war-music-when-johnny-comes-marching-home-again" target="_blank">battlefields.org</a>
    </span>
    <br><br>`,
    a: [
      { text: '‚ÄúLadies‚Äù is the singular form of ‚Äúlady‚Äù.', isCorrect: false },
      { text: '‚ÄúHim‚Äù is a possessive pronoun.', isCorrect: false },
      { text: '‚ÄúThen‚Äù is a demonstrative pronoun.', isCorrect: false },
      { text: '‚ÄúWhen Johnny comes marching home‚Äù is in the Present Continuous tense.', isCorrect: false },
      { text: '‚ÄúWe‚Äôll give, the men will cheer, the boys will shout, the ladies will turn out‚Äù are in the Future Simple tense.', isCorrect: true }
    ],
    explicacao: `Alternativa correta: As frases ‚Äúwe‚Äôll give‚Äù, ‚Äúthe men will cheer‚Äù, ‚Äúthe boys will shout‚Äù, ‚Äúthe ladies will turn out‚Äù est√£o no Future Simple, pois utilizam o auxiliar ‚Äúwill‚Äù para indicar a√ß√µes futuras.<br><br>
    `
  },

  {
  q: `<b>Leia o trecho da can√ß√£o "When Johnny comes marching home" (Patrick Sarsfield Gilmore):</b><br>
  <i>
  When Johnny comes marching home again<br>
  Hurrah! Hurrah!<br>
  We'll give him a hearty welcome then<br>
  Hurrah! Hurrah!<br>
  The men will cheer and the boys will shout<br>
  The ladies they will all turn out<br>
  </i>
  <br>
  <span style="font-size:0.97em;color:#888;">
    Fonte: <a href="https://www.battlefields.org/learn/primary-sources/civil-war-music-when-johnny-comes-marching-home-again" target="_blank">battlefields.org</a>
  </span>`,
  a: [
    { text: '‚ÄúLadies‚Äù is the singular form of ‚Äúlady‚Äù.', isCorrect: false },
    { text: '‚ÄúHim‚Äù is a possessive pronoun.', isCorrect: false },
    { text: '‚ÄúThen‚Äù is a demonstrative pronoun.', isCorrect: false },
    { text: '‚ÄúWhen Johnny comes marching home‚Äù is in the Present Continuous tense.', isCorrect: false },
    { text: '‚ÄúWe‚Äôll give, the men will cheer, the boys will shout, the ladies will turn out‚Äù are in the Future Simple tense.', isCorrect: true }
  ],
  explicacao: `Alternativa correta: As frases ‚Äúwe‚Äôll give‚Äù, ‚Äúthe men will cheer‚Äù, ‚Äúthe boys will shout‚Äù, ‚Äúthe ladies will turn out‚Äù est√£o no Future Simple, pois utilizam o auxiliar ‚Äúwill‚Äù para indicar a√ß√µes futuras.`
},


{
  q: `<b>Leia o trecho da m√∫sica "The Logical Song" (Supertramp):</b><br>
  <i>
  When I was young, it seemed that life was so wonderful<br>
  A miracle, oh, it was beautiful, magical<br>
  And all the birds in the trees, well they'd be singing so happily<br>
  Oh, joyfully, oh, playfully watching me<br>
  But then they sent me away to teach me how to be sensible<br>
  Logical, oh, responsible, practical<br>
  Then they showed me a world where I could be so dependable<br>
  Oh, clinical, oh, intellectual, cynical
  </i>
  <br>
  <span style="font-size:0.97em;color:#888;">
    Fonte: The Logical Song ‚Äì Supertramp
  </span>`,
  a: [
    { text: "um consistente amadurecimento pessoal e intelectual.", isCorrect: false },
    { text: "um choque de realidades ao passar da juventude para a vida adulta.", isCorrect: true },
    { text: "o aumento da sua sensibilidade com o chegar da maturidade.", isCorrect: false },
    { text: "um forte apego √†s experi√™ncias que teve junto √† natureza.", isCorrect: false },
    { text: "uma grande eleva√ß√£o de sua moral durante o seu crescimento.", isCorrect: false }
  ],
  explicacao: `A can√ß√£o descreve a juventude como m√°gica e alegre. Depois, o eu-l√≠rico relata ser enviado para aprender a ser l√≥gico, pr√°tico e respons√°vel, passando a ver o mundo de forma cl√≠nica, intelectual e c√≠nica. Isso indica um choque de realidade ao transitar da juventude para a vida adulta.`
},
                  
      {
        q: `<b>Leia o trecho da m√∫sica "I hate it here" (Taylor Swift, 2024):</b><br>
        <i>
        "If comfort is a construct, I don't believe in good luck"<br>
        ...<br>
        Nostalgia is a mind's trick<br>
        If I'd been there, I'd hate it<br>
        It was freezing in the palace"
        </i>
        <br><span style="font-size:0.97em;color:#888;">Fonte: Taylor Swift, do √°lbum <i>The Tortured Poets Department</i>, 2024 (Adaptado).</span>
        <br><br>
        No texto, a percep√ß√£o de "conforto como constru√≠do" indica que o eu l√≠rico v√™ o conforto como`,
        a: [
          { text: "ref√∫gio mental para apaziguar as press√µes e o descontentamento da vida.", isCorrect: false },
          { text: "concep√ß√£o ligada √†s experi√™ncias infantis em mecanismos de enfrentamento.", isCorrect: false },
          { text: "conceito pressuposto, dependente da realidade concreta das pessoas.", isCorrect: false },
          { text: "dificuldade de ter autoafirma√ß√£o, por conta de quest√µes internas pendentes.", isCorrect: false },
          { text: "algo criado pela sociedade, produzindo falsa sensa√ß√£o de seguran√ßa.", isCorrect: true }
        ],
        explicacao: `O eu l√≠rico menciona que "conforto √© um construto" e que n√£o acredita em "boa sorte": "If comfort is a construct, I don't believe in good luck". Esta afirma√ß√£o reflete uma vis√£o cr√≠tica de que o conforto n√£o √© algo natural ou intr√≠nseco, mas sim uma ideia que √© constru√≠da socialmente. Portanto, essa constru√ß√£o cria uma falsa sensa√ß√£o de seguran√ßa e sugere que a realidade n√£o √© t√£o est√°vel quanto parece, confirmando a alternativa da letra [E].`
      }
    ]
  }
];

const medalTypes = [
  { name: "Ouro", icon: "fa-medal", class: "enem-music-medal-gold", emoji: "ü•á" },
  { name: "Prata", icon: "fa-medal", class: "enem-music-medal-silver", emoji: "ü•à" },
  { name: "Bronze", icon: "fa-medal", class: "enem-music-medal-bronze", emoji: "ü•â" }
];
const medalByAttempts = (n) => n === 1 ? 0 : n === 2 ? 1 : 2;
let currentTopic = 0, currentQ = 0;
let questoesTentativas = [];
let totalQuestoes = 0;

const ENEM_MUSIC_LEVEL = "ENEM_MUSICA";

// Shuffle utilit√°rio
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function embaralharTudo() {
  shuffle(enemMusicTopics);
  enemMusicTopics.forEach(topic => {
    shuffle(topic.questions);
    topic.questions.forEach(q => {
      shuffle(q.a);
    });
  });
}

function getIndiceCorreta(q) {
  return q.a.findIndex(alt => alt.isCorrect);
}
function inicializaQuestoes() {
  embaralharTudo();
  questoesTentativas = [];
  enemMusicTopics.forEach(topic => {
    topic.questions.forEach(() => {
      questoesTentativas.push({ tentativas: 0, medalha: null, answered: false });
    });
  });
  totalQuestoes = questoesTentativas.length;
  window.totalQuestoes = totalQuestoes;
  window.nivelAtual = ENEM_MUSIC_LEVEL;
}

function getQuestaoIdx(topicIdx, qIdx) {
  let idx = 0;
  for (let t = 0; t < topicIdx; t++) {
    idx += enemMusicTopics[t].questions.length;
  }
  return idx + qIdx;
}
function renderEnemMusicExercise() {
  renderMedalsStatus();
  const t = enemMusicTopics[currentTopic];
  const q = t.questions[currentQ];
  const qidx = getQuestaoIdx(currentTopic, currentQ);
  const medalObj = questoesTentativas[qidx];

  let html = `
    <div>
      <div class="enem-music-topic-title">
        <i class="fa-solid ${t.icon}" style="color:${t.color}"></i> ${t.title}
      </div>
      <div class="enem-music-question">${q.q}</div>
      <form class="enem-music-options" id="enem-music-options">
        ${q.a.map((opt, i) => `
          <label>
            <input type="radio" name="enem-music" value="${i}" ${medalObj.answered ? "disabled" : ""}> ${opt.text}
          </label>
        `).join('')}
      </form>
      <div class="enem-music-feedback" id="enem-music-feedback"></div>
      <button class="enem-music-next-btn" id="enem-music-next-btn" style="display:none;">Pr√≥xima</button>
      <div class="enem-music-progress">
        Progresso: <b>${getEnemMusicProgress()}</b>
      </div>
    </div>
  `;
  document.getElementById('enem-music-root').innerHTML = html;

  if (medalObj.answered) {
    showGabarito(medalObj, t, q, qidx);
  }
  document.getElementById('enem-music-options').onclick = function(e) {
    if (e.target.name === "enem-music" && !medalObj.answered) {
      checkEnemMusic(e.target.value);
    }
  };
  document.getElementById('enem-music-next-btn').onclick = nextEnemMusic;
}

// Sempre mostra a explica√ß√£o correta da quest√£o
function checkEnemMusic(val) {
  val = +val;
  const t = enemMusicTopics[currentTopic];
  const q = t.questions[currentQ];
  const qidx = getQuestaoIdx(currentTopic, currentQ);
  const medalObj = questoesTentativas[qidx];
  medalObj.tentativas++;

  const correctIdx = getIndiceCorreta(q);
  const radios = document.querySelectorAll('.enem-music-options input[type="radio"]');
  if (val === correctIdx) {
    medalObj.answered = true;
    medalObj.medalha = medalByAttempts(medalObj.tentativas);
    showGabarito(medalObj, t, q, qidx);
    renderMedalsStatus();
    if (typeof window.premiarMedalhaEnem === "function") {
      window.premiarMedalhaEnem(ENEM_MUSIC_LEVEL, qidx + 1, medalTypes[medalObj.medalha].name.toLowerCase());
    }
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({ medalhaGanha: true, modulo: ENEM_MUSIC_LEVEL }, "*");
    }
  } else {
    radios.forEach(inp => inp.checked = false);
    const labels = document.querySelectorAll('.enem-music-options label');
    labels.forEach((label, i) => {
      label.classList.remove('correct', 'incorrect');
      if (i === val) label.classList.add('incorrect');
    });
    // Mostrar a explica√ß√£o correta da pr√≥pria quest√£o
    document.getElementById('enem-music-feedback').innerHTML =
      `<span style="color:#e53935;"><i class="fa-solid fa-circle-xmark"></i> Errou!</span>
       <div class="enem-music-explanation">${q.explicacao}</div>`;
  }
}
function showGabarito(medalObj, t, q, qidx) {
  const correctIdx = getIndiceCorreta(q);
  const labels = document.querySelectorAll('.enem-music-options label');
  labels.forEach((label, i) => {
    label.classList.remove('correct', 'incorrect');
    if (i === correctIdx) label.classList.add('correct');
  });
  document.querySelectorAll('.enem-music-options input[type="radio"]').forEach(inp => inp.disabled = true);
  const fb = document.getElementById('enem-music-feedback');
  let medalTxt = '';
  if (medalObj.medalha !== null) {
    if (medalObj.medalha === 0)
      medalTxt = `ü•á <b>Ouro conquistada!</b>`;
    else if (medalObj.medalha === 1)
      medalTxt = `ü•à <b>Prata conquistada!</b>`;
    else
      medalTxt = `ü•â <b>Bronze conquistada!</b>`;
  }
  fb.innerHTML = `<span style="color:#43a047;"><i class="fa-solid fa-circle-check"></i> Correto!</span> ${medalTxt}
      <div class="enem-music-explanation">${q.explicacao}</div>`;
  document.getElementById('enem-music-next-btn').style.display = "inline-block";
}
function nextEnemMusic() {
  const t = enemMusicTopics[currentTopic];
  if (currentQ < t.questions.length - 1) {
    currentQ++;
  } else if (currentTopic < enemMusicTopics.length - 1) {
    currentTopic++;
    currentQ = 0;
  } else {
    showEnemMusicResult();
    return;
  }
  renderEnemMusicExercise();
}
function getEnemMusicProgress() {
  let done = questoesTentativas.filter(q => q.answered).length;
  return `${done}/${totalQuestoes}`;
}
function showEnemMusicResult() {
  let ouro = questoesTentativas.filter(q => q.answered && q.medalha === 0).length;
  let percent = Math.round((ouro / totalQuestoes) * 100);
  let color = percent >= 60 ? "#43a047" : "#e53935";
  let msg = percent >= 60
    ? `<i class="fa-solid fa-crown"></i> Parab√©ns! Voc√™ concluiu o m√≥dulo de M√∫sica do ENEM com <b>${percent}%</b> de ü•á (acertos de primeira tentativa).<br><br>
       Continue praticando outros g√™neros de quest√µes de ENEM!`
    : `<i class="fa-solid fa-circle-xmark"></i> Voc√™ concluiu com <b>${percent}%</b> de OURO (acertos de primeira tentativa).<br><br>
       Voc√™ pode tentar novamente para conquistar mais ouros.`;

  document.getElementById('enem-music-root').innerHTML = `
    <div class="enem-music-end-message" style="color:${color};">
      <div style="font-size:1.18em;">
        ${msg}
      </div>
    </div>
  `;
  renderMedalsStatus(true);
}
function medalIconHtml(idx) {
  if (idx === 0) return `<span class="enem-music-medal enem-music-medal-gold"><i class="fa-solid fa-medal"></i></span>`;
  if (idx === 1) return `<span class="enem-music-medal enem-music-medal-silver"><i class="fa-solid fa-medal"></i></span>`;
  return `<span class="enem-music-medal enem-music-medal-bronze"><i class="fa-solid fa-medal"></i></span>`;
}
function renderMedalsStatus(showAll = false) {
  let html = `<div class="enem-music-medals-row">`;
  let idx = 0;
  enemMusicTopics.forEach((topic) => {
    topic.questions.forEach(() => {
      const m = questoesTentativas[idx];
      let medalStr = "";
      if (m.answered || showAll) {
        if (m.medalha !== null) {
          medalStr = medalIconHtml(m.medalha) + ` <span>${medalTypes[m.medalha].name}</span>`;
        } else {
          medalStr = `<span style="color:#aaa;">‚Äî</span>`;
        }
      }
      html += `<div class="enem-music-medal-item">
        <span style="font-weight:600;">${idx + 1}.</span> ${medalStr}
      </div>`;
      idx++;
    });
  });
  html += `</div>`;
  document.getElementById('enem-music-medals').innerHTML = html;
}

// Inicializa√ß√£o segura
if (Array.isArray(enemMusicTopics) && enemMusicTopics.length > 0) {
  inicializaQuestoes();
  renderEnemMusicExercise();
}
</script>
</body>
</html>